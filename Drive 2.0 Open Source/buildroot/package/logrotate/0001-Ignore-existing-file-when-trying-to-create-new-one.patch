From ccde906582ff417bd6ca25b1d25ec950dc407a6e Mon Sep 17 00:00:00 2001
From: Climate Corporation <daad-embedded-software@bayer.com>
Date: Wed, 20 Nov 2019 12:50:20 -0600
Subject: [PATCH] Ignore existing file when trying to create new one

---
 logrotate.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/logrotate.c b/logrotate.c
index 6055f3b..d181900 100644
--- a/logrotate.c
+++ b/logrotate.c
@@ -493,6 +493,7 @@ static int createOutputFile(char *fileName, int flags, struct stat *sb,
         if ((fd >= 0) || (errno != EEXIST))
             break;
 
+#if 0
         /* the destination file already exists, while it should not */
         now = *localtime(&nowSecs);
         fileName_size = strlen(fileName);
@@ -517,6 +518,15 @@ static int createOutputFile(char *fileName, int flags, struct stat *sb,
             return -1;
         }
         /* existing file renamed, try it once again */
+#else
+       message(MESS_ERROR, "destination %s already exists, using it\n", fileName);
+        /* try to open without exclusive access */
+       fd = open(fileName, (flags | O_NOFOLLOW),
+               (S_IRUSR | S_IWUSR) & sb->st_mode);
+       if (fd >= 0)
+           break;
+#endif
+
     }
 
     if (fd < 0) {
-- 
2.20.1

